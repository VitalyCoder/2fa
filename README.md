# 2FA Application

ะะพะปะฝะพััะฝะบัะธะพะฝะฐะปัะฝะพะต ะฟัะธะปะพะถะตะฝะธะต ะดะฒัััะฐะบัะพัะฝะพะน ะฐััะตะฝัะธัะธะบะฐัะธะธ ั Next.js ััะพะฝัะตะฝะดะพะผ, NestJS ะฑัะบะตะฝะดะพะผ, PostgreSQL ะฑะฐะทะพะน ะดะฐะฝะฝัั ะธ Nginx ะฒ ะบะฐัะตััะฒะต reverse proxy.

## ๐ ะััะธัะตะบัััะฐ

```
โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ
โ     Nginx       โโโโโถโ   Next.js       โ    โ    NestJS       โ    โ   PostgreSQL    โ
โ  Reverse Proxy  โ    โ   Frontend      โโโโโถโ    Backend      โโโโโถโ    Database     โ
โ   (Port 80/443) โ    โ  (Port 3000)    โ    โ  (Port 4200)    โ    โ  (Port 5433)    โ
โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ
```

## ๐ ะัััััะน ััะฐัั

### ะัะฟะพะปัะทัั ัะบัะธะฟั ัะฟัะฐะฒะปะตะฝะธั (ัะตะบะพะผะตะฝะดัะตััั)

```bash
# ะะฐะฟััะบ ะฟัะธะปะพะถะตะฝะธั
./manage.sh start

# ะัะพะฒะตัะบะฐ ัะพััะพัะฝะธั
./manage.sh status

# ะัะพัะผะพัั ะปะพะณะพะฒ
./manage.sh logs

# ะััะฐะฝะพะฒะบะฐ ะฟัะธะปะพะถะตะฝะธั
./manage.sh stop
```

### ะัะฟะพะปัะทัั Docker Compose ะฝะฐะฟััะผัั

```bash
# ะะฐะฟััะบ ะฒัะตั ัะตัะฒะธัะพะฒ
docker-compose up -d

# ะััะฐะฝะพะฒะบะฐ ะฒัะตั ัะตัะฒะธัะพะฒ
docker-compose down

# ะัะพัะผะพัั ะปะพะณะพะฒ
docker-compose logs -f
```

## ๐ ะขัะตะฑะพะฒะฐะฝะธั

- **Docker** (ะฒะตััะธั 20.10+)
- **Docker Compose** (ะฒะตััะธั 2.0+)
- **macOS/Linux/Windows** ั ะฟะพะดะดะตัะถะบะพะน Docker

## ๐ Endpoints

ะะพัะปะต ะทะฐะฟััะบะฐ ะฟัะธะปะพะถะตะฝะธะต ะดะพัััะฟะฝะพ ะฟะพ ัะปะตะดัััะธะผ ะฐะดัะตัะฐะผ:

- **Frontend**: https://localhost (HTTP ะฐะฒัะพะผะฐัะธัะตัะบะธ ะฟะตัะตะฝะฐะฟัะฐะฒะปัะตััั ะฝะฐ HTTPS)
- **API**: https://localhost/api/
- **Health Check**: http://health.localhost/health
- **Database**: localhost:5433

## ๐ SSL/TLS

ะัะธะปะพะถะตะฝะธะต ะธัะฟะพะปัะทัะตั ัะฐะผะพะฟะพะดะฟะธัะฐะฝะฝัะน SSL ัะตััะธัะธะบะฐั ะดะปั ัะฐะทัะฐะฑะพัะบะธ. ะ ะฑัะฐัะทะตัะต ะฟะพัะฒะธััั ะฟัะตะดัะฟัะตะถะดะตะฝะธะต ะพ ะฑะตะทะพะฟะฐัะฝะพััะธ - ััะพ ะฝะพัะผะฐะปัะฝะพ ะดะปั ะปะพะบะฐะปัะฝะพะน ัะฐะทัะฐะฑะพัะบะธ.

**ะะปั ะฟัะพะดะฐะบัะตะฝะฐ ะทะฐะผะตะฝะธัะต ัะตััะธัะธะบะฐัั**:
```bash
# ะะพะผะตััะธัะต ะฒะฐัะธ ัะตััะธัะธะบะฐัั ะฒ nginx/certs/
cp your_certificate.crt nginx/certs/server.crt
cp your_private_key.key nginx/certs/server.key
```

## ๐ ะะพะฝะธัะพัะธะฝะณ

### ะะพะณะธ ัะตัะฒะธัะพะฒ
```bash
# ะัะต ัะตัะฒะธัั
./manage.sh logs

# ะะพะฝะบัะตัะฝัะน ัะตัะฒะธั
./manage.sh logs nginx
./manage.sh logs client
./manage.sh logs server
./manage.sh logs postgres_twofactor
```

### ะกะพััะพัะฝะธะต ัะตัะฒะธัะพะฒ
```bash
./manage.sh status
```

### Health Checks
- **Nginx**: `curl http://health.localhost/health`
- **API**: `curl -k https://localhost/api/`
- **Frontend**: `curl -k https://localhost/`

## ๐ ะะฐะทัะฐะฑะพัะบะฐ

### ะกัััะบัััะฐ ะฟัะพะตะบัะฐ
```
2fa/
โโโ docker-compose.yml          # ะัะฝะพะฒะฝะฐั ะบะพะฝัะธะณััะฐัะธั Docker Compose
โโโ manage.sh                   # ะกะบัะธะฟั ัะฟัะฐะฒะปะตะฝะธั ะฟัะพะตะบัะพะผ
โโโ nginx/                      # ะะพะฝัะธะณััะฐัะธั Nginx
โ   โโโ conf.d/                 # ะะพะฝัะธะณััะฐัะธะพะฝะฝัะต ัะฐะนะปั
โ   โโโ certs/                  # SSL ัะตััะธัะธะบะฐัั
โ   โโโ README.md               # ะะพะบัะผะตะฝัะฐัะธั Nginx
โโโ front/                      # Next.js ะฟัะธะปะพะถะตะฝะธะต
โโโ back/                       # NestJS API
โโโ README.md                   # ะญัะพั ัะฐะนะป
```

### ะะพะบะฐะปัะฝะฐั ัะฐะทัะฐะฑะพัะบะฐ

ะะปั ัะฐะทัะฐะฑะพัะบะธ ะผะพะถะฝะพ ะทะฐะฟััะบะฐัั ัะตัะฒะธัั ะฟะพ ะพัะดะตะปัะฝะพััะธ:

```bash
# ะขะพะปัะบะพ ะฑะฐะทะฐ ะดะฐะฝะฝัั
docker-compose up -d postgres_twofactor

# ะะฐะฟััะบ ััะพะฝัะตะฝะดะฐ ะฒ dev ัะตะถะธะผะต
cd front && npm run dev

# ะะฐะฟััะบ ะฑัะบะตะฝะดะฐ ะฒ dev ัะตะถะธะผะต  
cd back && npm run start:dev
```

### ะะตัะตัััะพะตะฝะธะต ะบะพะฝัะตะนะฝะตัะพะฒ

```bash
# ะะตัะตัััะพะธัั ะฒัะต ะบะพะฝัะตะนะฝะตัั
docker-compose build

# ะะตัะตัััะพะธัั ะบะพะฝะบัะตัะฝัะน ัะตัะฒะธั
docker-compose build client
docker-compose build server
```

## ๐ง ะะพะฝัะธะณััะฐัะธั

### Nginx

ะะพะฝัะธะณััะฐัะธั nginx ะฒะบะปััะฐะตั:
- **SSL/TLS ัะตัะผะธะฝะฐัะธั** ั ะฐะฒัะพัะตะดะธัะตะบัะพะผ HTTPโHTTPS
- **HTTP/2 ะฟะพะดะดะตัะถะบะฐ**
- **Gzip ัะถะฐัะธะต**
- **Rate limiting** ะดะปั ะทะฐัะธัั ะพั DDoS
- **Security headers**
- **Health checks**

ะะพะดัะพะฑะฝะพััะธ ะฒ [nginx/README.md](./nginx/README.md)

### Environment Variables

ะัะฝะพะฒะฝัะต ะฟะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั ะฒ `.env`:
```env
# Database
POSTGRES_USER=your_user
POSTGRES_PASSWORD=your_password
POSTGRES_DATABASE=your_database

# JWT
JWT_SECRET=your_jwt_secret

# Other configurations...
```

## ๐ ะัะปะฐะดะบะฐ

### ะงะฐััะพ ะฒัััะตัะฐััะธะตัั ะฟัะพะฑะปะตะผั

1. **ะะพััั ะทะฐะฝััั**
   ```bash
   # ะัะพะฒะตัะธัั ะทะฐะฝัััะต ะฟะพััั
   lsof -i :80 -i :443 -i :3000 -i :4200 -i :5433
   
   # ะัะฒะพะฑะพะดะธัั ะฟะพััั ะธะปะธ ะธะทะผะตะฝะธัั ะฒ docker-compose.yml
   ```

2. **ะัะพะฑะปะตะผั ั SSL ัะตััะธัะธะบะฐัะพะผ**
   ```bash
   # ะะตัะตัะพะทะดะฐัั ัะตััะธัะธะบะฐั
   cd nginx/certs
   rm server.crt server.key
   openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
     -keyout server.key -out server.crt \
     -subj "/C=RU/ST=Moscow/L=Moscow/O=Development/CN=localhost"
   ```

3. **ะัะธะฑะบะธ ะบะพะฝัะธะณััะฐัะธะธ nginx**
   ```bash
   # ะัะพะฒะตัะธัั ะบะพะฝัะธะณััะฐัะธั
   ./manage.sh test-nginx
   
   # ะะพัะผะพััะตัั ะปะพะณะธ
   ./manage.sh logs nginx
   ```

### ะะพะปะฝะฐั ะพัะธััะบะฐ

**โ๏ธ ะะกะขะะะะะะ: ะญัะพ ัะดะฐะปะธั ะฒัะต ะดะฐะฝะฝัะต!**
```bash
./manage.sh clean
```

## ๐ค ะฃัะฐััะธะต ะฒ ัะฐะทัะฐะฑะพัะบะต

1. ะคะพัะบะฝะธัะต ัะตะฟะพะทะธัะพัะธะน
2. ะกะพะทะดะฐะนัะต ะฒะตัะบั ะดะปั ะฝะพะฒะพะน ััะฝะบัะธะธ
3. ะะฝะตัะธัะต ะธะทะผะตะฝะตะฝะธั
4. ะัะพัะตััะธััะนัะต ั ะฟะพะผะพััั `./manage.sh`
5. ะัะฟัะฐะฒััะต Pull Request

## ๐ ะะธัะตะฝะทะธั

MIT License

## ๐ ะะพะดะดะตัะถะบะฐ

ะัะปะธ ะฒะพะทะฝะธะบะปะธ ะฟัะพะฑะปะตะผั:

1. ะัะพะฒะตัััะต ัะพััะพัะฝะธะต ัะตัะฒะธัะพะฒ: `./manage.sh status`
2. ะะพัะผะพััะธัะต ะปะพะณะธ: `./manage.sh logs`
3. ะะตัะตะทะฐะฟัััะธัะต ะฟัะธะปะพะถะตะฝะธะต: `./manage.sh restart`

ะะปั ะฟะพะปััะตะฝะธั ะฟะพะผะพัะธ: `./manage.sh help`
